{% extends "_base.njk" %}

{% from "appArticle/macro.njk" import appArticle %}
{% from "appBadges/macro.njk" import appBadges %}
{% from "appCard/macro.njk" import appCard with context %}
{% from "appGithubIssue/macro.njk" import appGithubIssue %}
{% from "appIssueSheet/macro.njk" import appIssueSheet %}
{% from "prose/macro.njk" import appProse %}

{% block header %}
  {{ appArticleHeader({
      homeHref: homeUrl,
      "showNav": "false",
      "showSearch": "false",
      "organisation": {
        "name": "Business Services Authority",
        "split": productShortName
      },
    "ariaLabel": productLongName,
    "containerClasses": "nhsuk-width-container-fluid"
    })
  }}
{% endblock %}

{% block content %}
  {% call appArticle({
    header: {
      title: title | widont
    },
    footer: {
      date: page.date,
      modified: modified if modified,
      review: review
    }
  }) %}
    <div class="nhsbsa-sticky-nav">
      {% if content | toc %}
        <h2 class="nhsbsa-sticky-nav__heading">Contents</h2>
        {{ content | toc | safe }}
      {% endif %}
    </div>

    <div class="nhsbsa-article-content">
      {{ backLink({
        "href": "javascript:history.back()",
        "text": "Go back"
      }) }} 
      
      <div class="nhsbsa-article-header">
        <h1 class="nhsuk-heading-xl">
          {{ title }}
        </h1>
        {{ appBadges({
            badges: badges
        }) }}
      </div>
      
      {% call appIssueSheet({
        title: title,
        url: page.url,
        issuesheet: issuesheet,
        review: review,
        revisions: revisions
      }) %}
      {% endcall %}

      {% call appProse({
        prose: content
      }) -%}
      {% if related %}
      {% if related.title %}
      <h2 class="nhsuk-heading-l">
        {{ related.title }}
      </h2>
      {% endif %}
      {{ appCard({
        page: page,
        page_status: status,
        items: collections[related.tag],
        order: related.tag
      }) }}
      {% endif %}

      {%- endcall %}

      <hr>
      <h2 class="nhsuk-heading-l header-anchor" id="improve-the-playbook">Improve the playbook</h2>
      <p>If you spot anything factually incorrect with this page or have ideas for improvement,
        please share your suggestions.</p>

      <p>Before you start, you will need a <a href="https://github.com/join?source=login">GitHub account</a>.
      Github is an open forum where we collect feedback.</p>
      {{ appGithubIssue({
        issueTemplate: "playbook-proposal.md",
        issueTitle: "Change to page '" + page.filePathStem + "' ",
        linkText: "Suggest a change to this page"
        }) }}
    </div>

  {% endcall %}
{% endblock %}
